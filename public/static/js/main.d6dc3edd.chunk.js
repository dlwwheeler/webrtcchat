(this["webpackJsonpcreate-react-app"]=this["webpackJsonpcreate-react-app"]||[]).push([[0],{124:function(e,t,a){e.exports=a(158)},133:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=133},158:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(11),o=a.n(i),c=a(196),s=a(201),l=a(45),d=a(46),m=a(57),p=a(56),u=a(195),v=a(204),h=a(198),f=a(202),g=a(193),b=a(203),E=a(104),y=a.n(E),D=a(41),O=a(194);function P(){return n.a.createElement(D.a,{variant:"body2",color:"textSecondary",align:"center"},n.a.createElement(g.a,{color:"inherit",href:"https://devan-wheeler.net"},"Devan Wheeler")," ",(new Date).getFullYear(),".")}var I=Object(O.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}}));function j(e){var t=I();return n.a.createElement(u.a,{component:"main",maxWidth:"xs"},n.a.createElement(c.a,null),n.a.createElement("div",{className:t.paper},n.a.createElement(v.a,{className:t.avatar},n.a.createElement(y.a,null)),n.a.createElement(D.a,{component:"h1",variant:"h5"},"Sign in"),n.a.createElement("form",{className:t.form,noValidate:!0},n.a.createElement(f.a,{value:e.peerID,onChange:e.changePeerID,variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"peerid",label:"ID",name:"peerid",autoComplete:"",autoFocus:!0}),n.a.createElement(h.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:t.submit},"Send ID to Server"))),n.a.createElement(b.a,{mt:8},n.a.createElement(P,null)))}var w=a(30);var k=function(e){var t=Object(r.useRef)({srcObject:e.props});return t.current&&(t.current.srcObject=e.props),n.a.createElement("video",{ref:t,autoPlay:!0})},x=a(105),S=a.n(x),T=a(67),V=a(58),C=a(108),N=Object(C.a)({palette:{primary:{main:"#556cd6"},secondary:{main:"#19857b"},error:{main:V.a.A400},background:{default:"#fff"}}}),W=Object(C.a)({paper:{marginTop:N.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},form:{width:"100%",marginTop:N.spacing(1)},submit:{margin:N.spacing(3,0,2)},root:{maxWidth:345},media:{height:0,paddingTop:"56.25%"},expand:{transform:"rotate(0deg)",marginLeft:"auto",transition:N.transitions.create("transform",{duration:N.transitions.duration.shortest})},expandOpen:{transform:"rotate(180deg)"},avatar:{}}),U=Object(T.a)(Object(T.a)({},N),W),M=(a(134),a(135),a(197)),F=a(199),J=a(200),L=a(107),q=a.n(L);function A(){return n.a.createElement(D.a,{variant:"body2",color:"textSecondary",align:"center"},n.a.createElement(g.a,{color:"inherit",href:"https://devan-wheeler.net"},"Devan Wheeler")," ",(new Date).getFullYear(),".")}var G=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var r;Object(l.a)(this,a),(r=t.call(this,e)).state={peers:[],connectedPeers:[],peer:{},media:i,classes:{},videos:[],video:{}},r.searchPeers=r.searchPeers.bind(Object(w.a)(r)),r.applyVideoToPeer=r.applyVideoToPeer.bind(Object(w.a)(r)),r.initVideo=r.initVideo.bind(Object(w.a)(r)),r.addPeer=r.addPeer.bind(Object(w.a)(r)),r.state.peer=new S.a(e.props.peerID,{host:"js.devan-wheeler.net",port:9e3,debug:1,secure:!0});var n=r.state.peer,i=r.state.media,o=Object(w.a)(r);return r.searchPeers(),n.on("call",(function(e){o.state.video&&(console.log("recieved"),e.answer(o.state.video)),e.on("stream",(function(t){console.log(t),o.state.connectedPeers.includes(e.metadata.peerID)||(o.setState({connectedPeers:o.state.connectedPeers.concat(e.metadata.peerID)}),o.applyVideoToPeer({video:t,peerID:e.metadata.peerID}))}))})),r}return Object(d.a)(a,[{key:"applyVideoToPeer",value:function(e){e.peerID&&this.setState({videos:this.state.videos.concat({video:e.video,peerID:e.peerID})})}},{key:"initVideo",value:function(){this.setState({video:this.webcam.stream})}},{key:"searchPeers",value:function(){var e=this;this.state.peer.listAllPeers((function(t){e.setState({peers:t})}))}},{key:"addPeer",value:function(e){var t=this;if(console.log(e),!this.state.connectedPeers.includes(e)&&e!==this.state.peer.id){var a={peerID:this.state.peer.id,connectedPeers:t.state.connectedPeers},r=this.state.peer.call(e,this.state.video,{metadata:a});r.on("stream",(function(e){console.log(e,r.metadata.peerID),t.state.connectedPeers.includes(r.metadata.peerID)||(console.log("add video"),t.applyVideoToPeer({video:e,peerID:r.metadata.peerID}),t.setState({connectedPeers:t.state.connectedPeers.concat(r.metadata.peerID)}))}))}}},{key:"render",value:function(){var e=this;return n.a.createElement(u.a,{component:"main",maxWidth:"xs"},n.a.createElement(c.a,null),n.a.createElement("div",{className:JSON.stringify(U.paper)},n.a.createElement(D.a,{component:"h1",variant:"h5"},"Video Chat"),n.a.createElement(q.a,{ref:function(t){return e.webcam=t},onUserMedia:this.initVideo}),this.state.videos.map((function(e,t){return n.a.createElement("div",{key:t},n.a.createElement(k,{props:e.video}))})),n.a.createElement(h.a,{onClick:this.searchPeers,variant:"contained",color:"primary",className:JSON.stringify(U.submit)},"Check Who's Online")),n.a.createElement(M.a,null,this.state.peers.map((function(t,a){return n.a.createElement(F.a,{button:!0,key:a,onClick:function(){e.addPeer(t)}},n.a.createElement(J.a,{primary:t}))}))),n.a.createElement(b.a,{mt:8},n.a.createElement(A,null)))}}]),a}(n.a.Component);function R(e){var t=(e=e.props).peerID;return t&&""!=t?n.a.createElement(G,{props:e}):n.a.createElement(j,{props:e.peerID})}var Y=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var r;Object(l.a)(this,a),r=t.call(this,e);var n=new URLSearchParams(window.location.search).get("peerid"),i=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return r.state={peerID:n,media:i},r}return Object(d.a)(a,[{key:"render",value:function(){return n.a.createElement(u.a,{maxWidth:"sm"},n.a.createElement(R,{props:this.state}))}}]),a}(n.a.Component);o.a.render(n.a.createElement(s.a,{theme:U},n.a.createElement(c.a,null),n.a.createElement(Y,null)),document.querySelector("#root"))}},[[124,1,2]]]);
//# sourceMappingURL=main.d6dc3edd.chunk.js.map